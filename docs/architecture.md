## Architecture Overview

FabManage-Clean is a production management system for scenography/decor projects. The platform integrates project workflow, tile-based production, CNC preparation, materials/inventory, logistics, and basic client management.

### Technology stack
- React 18 + TypeScript (strict) + Vite
- UI: Ant Design with custom theme
- State: Zustand (slice pattern) + TanStack Query
- Backend: Supabase (Auth, Database, Storage) and a local Node/Express API for development/demo
- PWA: offline-ready shell with Workbox via Vite PWA plugin
- Containerization: Docker multi-stage, Nginx static hosting

### High-level modules
- Projects & modules: pricing → concept → technical_design → production → materials → logistics
- Tiles: unique elements flowing through design → approval → CNC → production → assembly
- CNC integration: estimation from DXF, queue priority by deadline and client priority
- Materials: consolidated BOM, ordering, inventory levels and alerts
- Logistics: packing lists, routes, installation tasks

### Frontend architecture
- Routing: React Router v7
- State:
  - Global domain stores in `src/stores/*` with clear boundaries (projects, tiles, materials, logistics, subcontractors, calendar)
  - Async work via services in `src/services/*` and `src/lib/httpClient.ts` abstraction
- Data fetching:
  - TanStack Query as primary cache for server data
  - httpClient routes requests to REST or Supabase based on connection strategy
- UI patterns:
  - Ant Design components
  - Drawers for critical edits (placement="right")
  - Loading states for all async operations
  - Tables with pagination and responsive columns

### Backend architecture
- Supabase as primary DB/Auth/Storage
- Local Node server (`backend/src/server.ts`) for demo/dev endpoints:
  - `/api/health`, `/api/clients`, `/api/projects`, `/api/tiles`, `/api/materials/bom`
- Row Level Security (RLS) enforced in Supabase environments

### Data flow
1. UI triggers actions (e.g., edit tile in a Drawer)
2. Store actions call service layer (Zod-validated inputs)
3. httpClient decides strategy (Supabase vs REST; handles auth, errors, retries)
4. TanStack Query updates cache; Zustand stores update UI state
5. Realtime subscriptions broadcast changes to listening components

### Directory layout (selected)
```
src/
  components/        # Reusable UI components (Drawers, Kanban, Gantt, Materials)
  pages/             # Route components
  stores/            # Zustand slices per domain
  services/          # API and Supabase integration
  lib/               # Utilities (httpClient, connection monitor, logging, DXF)
  types/             # Rich TypeScript models (projects, tiles, materials, enums)
```

### Cross-cutting concerns
- Validation: Zod schemas for user inputs and domain entities
- Security: RLS, sanitized HTML (DOMPurify when needed), least-privilege APIs
- Observability: structured logging via `src/lib/logger.ts`
- Errors: global ErrorBoundary, consistent `ApiError` type, user-friendly feedback

### Performance
- Code splitting per route; lazy-load heavy viewers (Speckle)
- Virtualization for long lists
- Memoization of expensive components and computations

### PWA
- Installable PWA with offline shell, service worker generated by Vite PWA plugin

### Future diagrams
- Sequence and component diagrams are tracked in `d:/Cursor_Workspaces/fabManage/architecture.drawio`. Export PNGs can be added here when updated.


